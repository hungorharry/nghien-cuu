<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điều Khiển Phân Tích Ngân Hàng Việt Nam 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: Ứng dụng được cấu trúc theo một luồng logic từ tổng quan đến chi tiết: 1. Tiêu đề chính. 2. Tổng quan thị trường vĩ mô. 3. Bảng điều khiển tương tác cốt lõi, bao gồm một biểu đồ bong bóng để so sánh trực quan Chất lượng (ROE) và Định giá (P/B), các bộ lọc để phân loại ngân hàng, và một bảng thông tin chi tiết tự động cập nhật. 4. Bảng xếp hạng chi tiết có thể sắp xếp. 5. Giải thích về khung phân tích. Cấu trúc này được chọn vì nó biến một báo cáo tĩnh thành một công cụ khám phá, cho phép người dùng tự tương tác với dữ liệu, kiểm tra các luận điểm đầu tư và đi sâu vào các ngân hàng cụ thể một cách trực quan và hiệu quả. -->
    <!-- Visualization & Content Choices: Dữ liệu so sánh P/B vs. ROE từ báo cáo -> Mục tiêu: So sánh -> Trực quan hóa: Biểu đồ bong bóng Chart.js -> Tương tác: Nhấp chuột để xem chi tiết, lọc theo phân loại -> Lý do: Cách tốt nhất để hình dung so sánh đa chiều và khám phá do người dùng điều khiển. Bảng điểm của báo cáo -> Mục tiêu: Thông báo -> Trực quan hóa: Biểu đồ thanh ngang Chart.js -> Lý do: Phân tích trực quan rõ ràng. Bảng chính của báo cáo -> Mục tiêu: Sắp xếp/So sánh -> Phương pháp: Bảng HTML có thể sắp xếp -> Lý do: Tiêu chuẩn và hiệu quả. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfcfb;
            color: #333;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 50vh;
            max-height: 500px;
        }
        .score-chart-container {
            position: relative;
            width: 100%;
            height: 200px;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .active-filter {
            background-color: #059669;
            color: white;
            font-weight: 600;
        }
        th {
            cursor: pointer;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-emerald-800">Phân Tích & Định Giá Ngành Ngân Hàng Việt Nam 2025</h1>
            <p class="mt-2 text-lg text-gray-600">Một góc nhìn tương tác theo triết lý đầu tư giá trị của Warren Buffett</p>
        </header>

        <main>
            <section id="overview" class="mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-emerald-600 pl-4">Bối Cảnh Vĩ Mô</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="p-6 rounded-lg shadow-md glassmorphism">
                        <h3 class="font-semibold text-lg text-emerald-700">Tăng Trưởng Tín Dụng</h3>
                        <p class="text-3xl font-bold mt-2">16% - 18%</p>
                        <p class="text-gray-600 mt-1">Dự báo năm 2025, được thúc đẩy bởi chính sách nới lỏng để hỗ trợ tăng trưởng GDP.</p>
                    </div>
                    <div class="p-6 rounded-lg shadow-md glassmorphism">
                        <h3 class="font-semibold text-lg text-amber-700">Áp Lực Lên NIM</h3>
                        <p class="text-3xl font-bold mt-2">Đi Ngang / Giảm</p>
                        <p class="text-gray-600 mt-1">Tăng trưởng tín dụng vượt huy động gây áp lực lên chi phí vốn (COF) và biên lãi ròng.</p>
                    </div>
                    <div class="p-6 rounded-lg shadow-md glassmorphism">
                        <h3 class="font-semibold text-lg text-red-700">Nợ Xấu Tiềm Ẩn</h3>
                        <p class="text-3xl font-bold mt-2">> 2%</p>
                        <p class="text-gray-600 mt-1">Tỷ lệ NPL nội bảng được kiểm soát, nhưng chi phí dự phòng cao cho thấy rủi ro tiềm ẩn.</p>
                    </div>
                </div>
            </section>

            <section id="dashboard" class="mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-emerald-600 pl-4">Bảng Điều Khiển So Sánh</h2>
                <div class="text-center mb-6">
                    <p class="text-gray-700">So sánh trực quan các ngân hàng dựa trên Chất Lượng Sinh Lời (ROE) và Định Giá (P/B). Kích thước bong bóng thể hiện Tổng Điểm đánh giá. Nhấp vào một bong bóng để xem phân tích chi tiết.</p>
                </div>
                <div class="flex justify-center space-x-2 mb-6" id="filter-buttons">
                    <button data-filter="Tất cả" class="px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-all duration-200 active-filter">Tất cả</button>
                    <button data-filter="Pháo Đài" class="px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-all duration-200 hover:bg-emerald-100">"Pháo Đài"</button>
                    <button data-filter="Cỗ Máy Tăng Trưởng" class="px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-all duration-200 hover:bg-emerald-100">"Cỗ Máy Tăng Trưởng"</button>
                    <button data-filter="Cạm Bẫy Giá Rẻ" class="px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-all duration-200 hover:bg-emerald-100">"Cạm Bẫy Giá Rẻ"</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="p-4 rounded-lg shadow-lg glassmorphism">
                        <div class="chart-container">
                            <canvas id="bankBubbleChart"></canvas>
                        </div>
                    </div>
                    <div id="bankDetail" class="p-6 rounded-lg shadow-lg glassmorphism overflow-y-auto" style="max-height: 60vh;">
                    </div>
                </div>
            </section>
            
            <section id="ranking" class="mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-emerald-600 pl-4">Bảng Xếp Hạng Toàn Diện</h2>
                 <div class="overflow-x-auto rounded-lg shadow-md">
                    <table class="w-full text-sm text-left text-gray-600" id="rankingTable">
                        <thead class="text-xs text-emerald-800 uppercase bg-emerald-50">
                            <tr>
                                <th scope="col" class="px-6 py-3" data-sort="ticker">Mã CK</th>
                                <th scope="col" class="px-6 py-3" data-sort="score">Tổng Điểm ↓</th>
                                <th scope="col" class="px-6 py-3" data-sort="pb">P/B</th>
                                <th scope="col" class="px-6 py-3" data-sort="roe">ROE</th>
                                <th scope="col" class="px-6 py-3" data-sort="npl">NPL (%)</th>
                                <th scope="col" class="px-6 py-3" data-sort="casa">CASA (%)</th>
                                <th scope="col" class="px-6 py-3" data-sort="recommendation">Khuyến Nghị</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <script>
        const bankData = [
            // Dữ liệu đã được cập nhật với lý do chi tiết hơn cho các khuyến nghị "Tránh xa"
            { ticker: 'VCB', name: 'Vietcombank', pb: 2.8, roe: 21, npl: 1.0, casa: 34, car: 10, score: 9.0, moatScore: 3.8, mgmtScore: 2.8, finScore: 1.9, valScore: 0.5, intrinsicValue: 95000, bargainPrice: 66500, recommendation: 'Mua & Nắm giữ', classification: 'Pháo Đài', summary: 'Ngân hàng số 1 Việt Nam với con hào kinh tế toàn diện: thương hiệu, chất lượng tài sản tốt nhất, tỷ lệ CASA top đầu. Là "viên kim cương" của ngành, xứng đáng với định giá P/B cao nhất.' },
            { ticker: 'TCB', name: 'Techcombank', pb: 1.2, roe: 19, npl: 1.3, casa: 40, car: 15, score: 9.1, moatScore: 3.9, mgmtScore: 2.7, finScore: 1.8, valScore: 0.7, intrinsicValue: 50000, bargainPrice: 35000, recommendation: 'Mua & Nắm giữ', classification: 'Pháo Đài', summary: 'Sở hữu con hào kinh tế mạnh nhất từ tỷ lệ CASA luôn dẫn đầu hệ thống. Là cỗ máy tạo lợi nhuận hiệu quả bậc nhất với ban lãnh đạo có tầm nhìn chiến lược.' },
            { ticker: 'ACB', name: 'ACB', pb: 1.4, roe: 23, npl: 1.3, casa: 22, car: 13, score: 8.8, moatScore: 3.5, mgmtScore: 2.9, finScore: 1.8, valScore: 0.6, intrinsicValue: 35000, bargainPrice: 24500, recommendation: 'Mua & Nắm giữ', classification: 'Pháo Đài', summary: 'Ngân hàng bán lẻ hàng đầu với thương hiệu uy tín, văn hóa quản trị rủi ro thận trọng và chất lượng tài sản luôn tốt nhất ngành. Một doanh nghiệp tuyệt vời hiếm khi có giá rẻ.' },
            { ticker: 'MBB', name: 'MBBank', pb: 1.3, roe: 22, npl: 1.8, casa: 35, car: 12, score: 8.5, moatScore: 3.6, mgmtScore: 2.6, finScore: 1.7, valScore: 0.6, intrinsicValue: 34000, bargainPrice: 23800, recommendation: 'Mua', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Con hào kinh tế từ hệ sinh thái "quân đội" và tài chính toàn diện. Tiên phong chuyển đổi số với tỷ lệ CASA cao, là một doanh nghiệp chất lượng cao với tiềm năng tăng trưởng.' },
            { ticker: 'MSB', name: 'MSB', pb: 0.9, roe: 16, npl: 1.8, casa: 24, car: 12, score: 7.6, moatScore: 2.8, mgmtScore: 2.5, finScore: 1.5, valScore: 0.8, intrinsicValue: 22000, bargainPrice: 15400, recommendation: 'Mua', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Đang trong giai đoạn tái cấu trúc mạnh mẽ, với điểm sáng là tỷ lệ CASA cao và chiến lược rõ ràng. Định giá P/B hấp dẫn, là cơ hội "chuyển mình" tiềm năng.' },
            { ticker: 'TPB', name: 'TPBank', pb: 1.4, roe: 19, npl: 1.7, casa: 18, car: 12, score: 7.7, moatScore: 3.1, mgmtScore: 2.5, finScore: 1.5, valScore: 0.6, intrinsicValue: 29000, bargainPrice: 20300, recommendation: 'Mua', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Tiên phong về ngân hàng số với nền tảng công nghệ hiện đại, thu hút mạnh mẽ tệp khách hàng trẻ. Giá trị gắn liền với khả năng duy trì sự đổi mới công nghệ.' },
            { ticker: 'VPB', name: 'VPBank', pb: 1.1, roe: 15, npl: 2.5, casa: 18, car: 17, score: 7.4, moatScore: 2.9, mgmtScore: 2.4, finScore: 1.4, valScore: 0.7, intrinsicValue: 38000, bargainPrice: 26600, recommendation: 'Quan sát', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Nền tảng vốn vững chắc sau thương vụ SMBC. Câu chuyện đầu tư phụ thuộc vào sự phục hồi của FE Credit và khả năng tận dụng nguồn vốn dồi dào để tăng trưởng.' },
            { ticker: 'VIB', name: 'VIB', pb: 1.6, roe: 25, npl: 2.2, casa: 10, car: 11, score: 7.3, moatScore: 2.7, mgmtScore: 2.5, finScore: 1.6, valScore: 0.5, intrinsicValue: 30000, bargainPrice: 21000, recommendation: 'Quan sát', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Ngân hàng bán lẻ hàng đầu với chiến lược tập trung vào cho vay mua ô tô. ROE cao nhưng rủi ro tập trung danh mục lớn, phụ thuộc vào tính chu kỳ của ngành ô tô.' },
            { ticker: 'CTG', name: 'VietinBank', pb: 1.7, roe: 18, npl: 1.3, casa: 20, car: 9, score: 7.4, moatScore: 3.2, mgmtScore: 2.2, finScore: 1.6, valScore: 0.4, intrinsicValue: 55000, bargainPrice: 38500, recommendation: 'Quan sát (chờ tăng vốn)', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Ngân hàng Big4 với chất lượng tài sản tốt. Câu chuyện đầu tư phụ thuộc hoàn toàn vào việc tăng vốn thành công để giải quyết nút thắt lớn nhất cho sự phát triển.' },
            { ticker: 'BID', name: 'BIDV', pb: 1.6, roe: 17, npl: 1.6, casa: 19, car: 9, score: 7.4, moatScore: 3.3, mgmtScore: 2.1, finScore: 1.5, valScore: 0.5, intrinsicValue: 48000, bargainPrice: 33600, recommendation: 'Quan sát (chờ tăng vốn)', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Ngân hàng lớn nhất về tổng tài sản. Hiệu quả sinh lời thấp hơn tư nhân do thực hiện nhiệm vụ chính trị. Kế hoạch tăng vốn thành công sẽ là cú hích lớn.' },
            { ticker: 'HDB', name: 'HDBank', pb: 1.3, roe: 21, npl: 1.9, casa: 12, car: 12, score: 7.5, moatScore: 3.0, mgmtScore: 2.4, finScore: 1.5, valScore: 0.6, intrinsicValue: 32000, bargainPrice: 22400, recommendation: 'Quan sát', classification: 'Cỗ Máy Tăng Trưởng', summary: 'Lợi thế từ hệ sinh thái đa dạng (ngân hàng, tài chính tiêu dùng, hàng không). Rủi ro chính đến từ mảng tài chính tiêu dùng nhạy cảm với chu kỳ kinh tế.' },
            { ticker: 'SHB', name: 'SHB', pb: 1.1, roe: 16, npl: 2.1, casa: 10, car: 11, score: 6.8, moatScore: 2.5, mgmtScore: 2.0, finScore: 1.5, valScore: 0.8, intrinsicValue: 25000, bargainPrice: 17500, recommendation: 'Quan sát (câu chuyện tái cơ cấu)', classification: 'Cạm Bẫy Giá Rẻ', summary: 'Đang có những bước tiến lớn trong việc xử lý nợ xấu tồn đọng. Định giá P/B thấp, là cơ hội cho nhà đầu tư chấp nhận rủi ro, đặt cược vào sự phục hồi.' },
            { ticker: 'OCB', name: 'OCB', pb: 0.9, roe: 10, npl: 3.2, casa: 15, car: 12, score: 6.9, moatScore: 2.6, mgmtScore: 2.3, finScore: 1.2, valScore: 0.8, intrinsicValue: 16000, bargainPrice: 11200, recommendation: 'Quan sát (chờ xử lý nợ xấu)', classification: 'Cạm Bẫy Giá Rẻ', summary: 'Năng động về chuyển đổi số nhưng chất lượng tài sản là điểm đáng lo ngại với tỷ lệ nợ xấu tăng cao. Cần một biên an toàn lớn để bù đắp rủi ro.' },
            { ticker: 'LPB', name: 'LPBank', pb: 2.0, roe: 17, npl: 1.7, casa: 8, score: 6.7, moatScore: 3.0, mgmtScore: 2.0, finScore: 1.4, valScore: 0.3, intrinsicValue: 40000, bargainPrice: 28000, recommendation: 'Bán/Tránh xa', summary: 'Lợi thế mạng lưới bưu điện độc quyền nhưng chất lượng tài sản cần cải thiện. Rủi ro chính là <b>định giá P/B hiện tại quá cao (khoảng 2.0x) so với chất lượng hoạt động</b>, tiềm ẩn rủi ro giảm giá mạnh.' },
            { ticker: 'SSB', name: 'SeABank', pb: 1.2, roe: 14, npl: 2.0, casa: 11, car: 12, score: 6.5, moatScore: 2.4, mgmtScore: 2.1, finScore: 1.3, valScore: 0.7, intrinsicValue: 24000, bargainPrice: 16800, recommendation: 'Bán/Tránh xa', summary: 'Ngân hàng tầm trung với các chỉ số ở mức trung bình ngành. Lý do cần tránh là <b>không có lợi thế cạnh tranh rõ rệt</b> để tạo ra lợi nhuận vượt trội, do đó không xứng đáng với mức định giá hiện tại so với các lựa chọn khác.' },
            { ticker: 'EIB', name: 'Eximbank', pb: 1.0, roe: 8, npl: 2.3, casa: 15, car: 13, score: 5.0, moatScore: 2.0, mgmtScore: 1.0, finScore: 1.2, valScore: 0.8, intrinsicValue: 15000, bargainPrice: 10500, recommendation: 'Tránh xa', summary: 'Một "cạm bẫy giá rẻ" kinh điển. Lý do cần tránh là <b>bất ổn kéo dài trong quản trị thượng tầng và mâu thuẫn cổ đông</b> đã làm tê liệt hoạt động, xói mòn lợi thế cạnh tranh. Rủi ro quản trị là quá lớn.' },
            { ticker: 'STB', name: 'Sacombank', pb: 1.8, roe: 26, npl: 2.2, casa: 21, car: 11, score: 5.5, moatScore: 3.0, mgmtScore: 0.5, finScore: 1.6, valScore: 0.4, intrinsicValue: 45000, bargainPrice: 22500, recommendation: 'TRÁNH XA', summary: 'Gót chân Achilles là quản trị. Lý do phải TRÁNH XA là <b>Kết luận thanh tra của NHNN chỉ ra 6 vi phạm nghiêm trọng</b>, cho thấy yếu kém hệ thống trong quản trị rủi ro. Lợi nhuận cao nhưng không bền vững, rủi ro mất vốn rất lớn.' },
        ];

        let bubbleChart;
        let scoreChart;
        let currentFilter = 'Tất cả';
        let sortState = { column: 'score', direction: 'desc' };

        const classificationColors = {
            'Pháo Đài': 'rgba(5, 150, 105, 0.7)',
            'Cỗ Máy Tăng Trưởng': 'rgba(2, 132, 199, 0.7)',
            'Cạm Bẫy Giá Rẻ': 'rgba(220, 38, 38, 0.7)',
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderBubbleChart();
            updateBankDetail(bankData.find(b => b.ticker === 'TCB')); // Mặc định hiển thị TCB
            renderTable();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('filter-buttons').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    currentFilter = e.target.dataset.filter;
                    document.querySelectorAll('#filter-buttons button').forEach(btn => btn.classList.remove('active-filter'));
                    e.target.classList.add('active-filter');
                    renderBubbleChart();
                }
            });

            document.getElementById('rankingTable').querySelector('thead').addEventListener('click', (e) => {
                if (e.target.tagName === 'TH') {
                    const column = e.target.dataset.sort;
                    if (sortState.column === column) {
                        sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortState.column = column;
                        sortState.direction = (column === 'npl' || column === 'pb') ? 'asc' : 'desc'; // Mặc định sắp xếp NPL, P/B tăng dần
                    }
                    renderTable();
                }
            });
        }

        function renderBubbleChart() {
            const ctx = document.getElementById('bankBubbleChart').getContext('2d');
            
            const filteredData = bankData.filter(bank => {
                if (currentFilter === 'Tất cả') return true;
                return bank.classification === currentFilter;
            });

            const chartData = {
                datasets: filteredData.map(bank => ({
                    label: bank.ticker,
                    data: [{
                        x: bank.pb,
                        y: bank.roe,
                        r: bank.score * 2.5 // Bán kính bong bóng dựa trên điểm số
                    }],
                    backgroundColor: classificationColors[bank.classification] || 'rgba(107, 114, 128, 0.7)',
                    borderColor: 'rgba(255, 255, 255, 0.8)',
                    borderWidth: 1,
                }))
            };

            if (bubbleChart) {
                bubbleChart.destroy();
            }

            bubbleChart = new Chart(ctx, {
                type: 'bubble',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const bank = filteredData[context.datasetIndex];
                                    return `${bank.ticker}: P/B=${bank.pb.toFixed(2)}, ROE=${bank.roe.toFixed(1)}%, Điểm=${bank.score.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Định giá P/B (Rẻ → Đắt)', font: { weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y: {
                            title: { display: true, text: 'Chất lượng ROE (%)', font: { weight: 'bold' } },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const bank = filteredData[element.datasetIndex];
                            updateBankDetail(bank);
                        }
                    }
                }
            });
        }

        function updateBankDetail(bank) {
            const detailDiv = document.getElementById('bankDetail');
            const recommendationColor = bank.recommendation.includes('Mua') ? 'text-emerald-600' : (bank.recommendation.toUpperCase().includes('TRÁNH') ? 'text-red-600' : 'text-amber-600');
            
            detailDiv.innerHTML = `
                <div class="flex items-center mb-4">
                    <h3 class="text-2xl font-bold text-gray-800">${bank.name} (${bank.ticker})</h3>
                    <span class="ml-auto px-3 py-1 text-sm font-semibold rounded-full" style="background-color: ${classificationColors[bank.classification]}; color: white;">
                        ${bank.classification}
                    </span>
                </div>
                <p class="text-gray-700 mb-4">${bank.summary}</p>
                <div class="score-chart-container mb-4">
                    <canvas id="scoreChart"></canvas>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>P/B:</strong> <span class="font-semibold">${bank.pb.toFixed(2)}x</span></div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>ROE:</strong> <span class="font-semibold">${bank.roe.toFixed(1)}%</span></div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>NPL:</strong> <span class="font-semibold">${bank.npl.toFixed(1)}%</span></div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>CASA:</strong> <span class="font-semibold">${bank.casa.toFixed(1)}%</span></div>
                </div>
                <div class="border-t pt-4">
                    <p class="font-semibold text-gray-800">Định giá & Khuyến nghị:</p>
                    <div class="flex justify-between items-center mt-2">
                        <span>Giá trị nội tại:</span>
                        <span class="font-bold text-lg">${new Intl.NumberFormat('vi-VN').format(bank.intrinsicValue)} VND</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span>Vùng giá hời:</span>
                        <span class="font-bold text-lg text-emerald-700">< ${new Intl.NumberFormat('vi-VN').format(bank.bargainPrice)} VND</span>
                    </div>
                    <div class="mt-3 text-center p-2 rounded-lg font-bold ${recommendationColor} bg-opacity-20 ${bank.recommendation.includes('Mua') ? 'bg-emerald-100' : (bank.recommendation.toUpperCase().includes('TRÁNH') ? 'bg-red-100' : 'bg-amber-100')}">
                        ${bank.recommendation.toUpperCase()}
                    </div>
                </div>
            `;
            renderScoreChart(bank);
        }

        function renderScoreChart(bank) {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            if (scoreChart) {
                scoreChart.destroy();
            }
            scoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Lợi thế Cạnh tranh (4)', 'Ban Lãnh đạo (3)', 'Sức khỏe TC (2)', 'Định giá (1)'],
                    datasets: [{
                        label: 'Điểm',
                        data: [bank.moatScore, bank.mgmtScore, bank.finScore, bank.valScore],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: `Tổng Điểm: ${bank.score.toFixed(1)} / 10`, font: { size: 14, weight: 'bold' } }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 4,
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        }
                    }
                }
            });
        }
        
        function renderTable() {
            const tableBody = document.getElementById('rankingTable').querySelector('tbody');
            
            const sortedData = [...bankData].sort((a, b) => {
                const valA = a[sortState.column];
                const valB = b[sortState.column];
                
                let comparison = 0;
                if (valA > valB) {
                    comparison = 1;
                } else if (valA < valB) {
                    comparison = -1;
                }
                
                return sortState.direction === 'desc' ? -comparison : comparison;
            });
            
            tableBody.innerHTML = sortedData.map(bank => {
                const recommendationColor = bank.recommendation.includes('Mua') ? 'text-emerald-600' : (bank.recommendation.toUpperCase().includes('TRÁNH') ? 'text-red-600' : 'text-amber-600');
                return `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${bank.ticker}</th>
                        <td class="px-6 py-4 font-bold">${bank.score.toFixed(1)}</td>
                        <td class="px-6 py-4">${bank.pb.toFixed(2)}</td>
                        <td class="px-6 py-4">${bank.roe.toFixed(1)}%</td>
                        <td class="px-6 py-4">${bank.npl.toFixed(1)}%</td>
                        <td class="px-6 py-4">${bank.casa.toFixed(1)}%</td>
                        <td class="px-6 py-4 font-semibold ${recommendationColor}">${bank.recommendation}</td>
                    </tr>
                `;
            }).join('');

            // Cập nhật mũi tên sắp xếp
            document.querySelectorAll('#rankingTable th').forEach(th => {
                th.innerHTML = th.innerHTML.replace(' ↑', '').replace(' ↓', '');
                if (th.dataset.sort === sortState.column) {
                    th.innerHTML += sortState.direction === 'asc' ? ' ↑' : ' ↓';
                }
            });
        }

    </script>
</body>
</html>