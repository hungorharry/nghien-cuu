<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc nghiệm Vui: Phân tích Dữ liệu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            overflow-x: hidden;
        }
        .quiz-container {
            max-width: 640px;
            width: 100%;
        }
        .screen-container {
            width: 100%;
            display: none;
        }
        .screen-container.active {
            display: flex;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .btn {
            transition: all 0.2s ease-in-out;
            transform: translateY(0);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .answer-btn:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }
        .correct {
            background-image: linear-gradient(to right, #22c55e, #16a34a);
            color: white;
            border-color: #16a34a;
        }
        .incorrect {
            background-image: linear-gradient(to right, #ef4444, #dc2626);
            color: white;
            border-color: #dc2626;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .timer-bar-inner {
            height: 100%;
            background-image: linear-gradient(to right, #6366f1, #8b5cf6);
            border-radius: 9999px;
            transition: width 1s linear;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="quiz-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen-container flex-col items-center justify-center p-8 bg-white rounded-2xl shadow-xl active">
            <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-2 bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500">Trắc nghiệm Phân tích Dữ liệu</h1>
            <p class="text-slate-600 text-center mb-8">Bạn đã sẵn sàng để kiểm tra kiến thức của mình chưa?</p>
            <button id="start-btn" class="btn text-lg font-bold text-white bg-indigo-600 hover:bg-indigo-700 px-10 py-4 rounded-full shadow-lg">Bắt đầu!</button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="screen-container flex-col items-center bg-white rounded-2xl shadow-xl">
            <div class="w-full p-6 md:p-8">
                <div class="flex justify-between items-center mb-4">
                    <div id="progress-text" class="text-sm font-semibold text-slate-500">Câu 1 / 10</div>
                    <div class="text-sm font-semibold text-slate-500">Điểm: <span id="score">0</span></div>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-3 mb-6">
                    <div id="timer-bar" class="timer-bar-inner" style="width: 100%;"></div>
                </div>
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-center mb-8 min-h-[96px] flex items-center justify-center">Câu hỏi sẽ hiện ở đây...</h2>
            </div>
            <div id="answer-buttons" class="w-full grid grid-cols-1 md:grid-cols-2 gap-4 p-6 bg-slate-50 rounded-b-2xl">
                <!-- Answer buttons will be generated by JS -->
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="screen-container flex-col items-center justify-center p-8 bg-white rounded-2xl shadow-xl text-center">
            <h1 class="text-4xl font-extrabold mb-4">Hoàn thành!</h1>
            <p class="text-slate-600 text-lg mb-2">Điểm cuối cùng của bạn là:</p>
            <p id="final-score" class="text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500 mb-8">0</p>
            <p id="score-message" class="text-slate-700 font-medium mb-8"></p>
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="restart-btn" class="btn text-lg font-bold text-white bg-indigo-600 hover:bg-indigo-700 px-8 py-3 rounded-full shadow-lg">Chơi lại</button>
                <button id="review-btn" class="btn text-lg font-bold text-indigo-600 bg-white border-2 border-indigo-600 hover:bg-indigo-50 px-8 py-3 rounded-full shadow-lg hidden">Xem lại câu sai</button>
            </div>
        </div>
        
        <!-- Review Screen -->
        <div id="review-screen" class="screen-container flex-col p-6 md:p-8 bg-white rounded-2xl shadow-xl">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl md:text-3xl font-extrabold text-slate-800">Ôn tập lại</h1>
                <button id="back-to-score-btn" class="btn text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 px-5 py-2 rounded-full shadow-lg">Quay lại</button>
            </div>
            <div id="review-items-container" class="w-full h-[60vh] overflow-y-auto pr-2">
                <!-- Review items will be generated by JS -->
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const QUESTION_TIME_LIMIT = 15; // seconds
            const questions = [
                {
                    question: "Quá trình thu thập, chuyển đổi và tổ chức dữ liệu để rút ra kết luận được gọi là gì?",
                    answers: ["Data Science", "Data Analysis", "Data Strategy", "Data Design"],
                    correct: 1
                },
                {
                    question: "Ngôn ngữ nào được sử dụng phổ biến nhất để giao tiếp với cơ sở dữ liệu lớn?",
                    answers: ["Python", "JavaScript", "HTML", "SQL"],
                    correct: 3
                },
                {
                    question: "Việc biểu diễn dữ liệu bằng đồ họa (biểu đồ, bản đồ) được gọi là gì?",
                    answers: ["Data Design", "Data Strategy", "Data Visualization", "Data Ecosystem"],
                    correct: 2
                },
                {
                    question: "Kỹ thuật đặt câu hỏi 'Tại sao?' lặp đi lặp lại để tìm ra lý do cốt lõi của vấn đề là gì?",
                    answers: ["Gap Analysis", "The Five Whys", "Correlation Analysis", "Business Task"],
                    correct: 1
                },
                {
                    question: "'Tương quan không có nghĩa là nhân quả' là một lưu ý quan trọng trong khía cạnh nào của tư duy phân tích?",
                    answers: ["Visualization", "Strategy", "Problem-orientation", "Correlation"],
                    correct: 3
                },
                {
                    question: "Trong 6 bước của quy trình phân tích dữ liệu, bước nào diễn ra sau 'Process' (Xử lý)?",
                    answers: ["Prepare (Chuẩn bị)", "Share (Chia sẻ)", "Analyze (Phân tích)", "Act (Hành động)"],
                    correct: 2
                },
                {
                    question: "Công cụ nào phù hợp nhất để phân tích nhanh một bộ dữ liệu nhỏ và tạo biểu đồ đơn giản?",
                    answers: ["SQL Database", "Tableau", "Spreadsheets (Excel/Sheets)", "Python"],
                    correct: 2
                },
                {
                    question: "Việc sử dụng sự kiện (facts) để định hướng chiến lược kinh doanh được gọi là gì?",
                    answers: ["Gut Instinct", "Data-driven decision-making", "Data Ecosystem", "Business Task"],
                    correct: 1
                },
                 {
                    question: "Ai là người tập trung vào việc cải thiện quy trình, sản phẩm hoặc dịch vụ kinh doanh?",
                    answers: ["Data Analyst", "Data Scientist", "Business Analyst", "Data Engineer"],
                    correct: 2
                },
                {
                    question: "Trách nhiệm đảm bảo phân tích không tạo ra hoặc củng cố sự thiên vị (bias) thuộc về lĩnh vực nào?",
                    answers: ["Data Strategy", "Data Design", "Data Ethics & Fairness", "Data Management"],
                    correct: 2
                }
            ];

            // --- DOM ELEMENTS ---
            const startScreen = document.getElementById('start-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const endScreen = document.getElementById('end-screen');
            const reviewScreen = document.getElementById('review-screen');

            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const reviewBtn = document.getElementById('review-btn');
            const backToScoreBtn = document.getElementById('back-to-score-btn');
            
            const questionText = document.getElementById('question-text');
            const answerButtonsContainer = document.getElementById('answer-buttons');
            const progressText = document.getElementById('progress-text');
            const scoreText = document.getElementById('score');
            const timerBar = document.getElementById('timer-bar');

            const finalScoreText = document.getElementById('final-score');
            const scoreMessageText = document.getElementById('score-message');
            const reviewItemsContainer = document.getElementById('review-items-container');

            // --- SOUND EFFECTS (using Tone.js) ---
            let soundsReady = false;
            const correctSound = new Tone.Synth().toDestination();
            const incorrectSound = new Tone.Synth({ oscillator: { type: 'square' } }).toDestination();

            // --- QUIZ STATE ---
            let shuffledQuestions, currentQuestionIndex;
            let score;
            let timerInterval;
            let timeLeft;
            let incorrectlyAnswered = [];

            // --- FUNCTIONS ---
            function prepareSounds() {
                if (!soundsReady) {
                    Tone.start();
                    soundsReady = true;
                }
            }

            function switchScreen(screenToShow) {
                document.querySelectorAll('.screen-container').forEach(screen => {
                    screen.classList.remove('active');
                });
                screenToShow.classList.add('active');
            }

            function startGame() {
                prepareSounds();
                switchScreen(quizScreen);

                shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
                currentQuestionIndex = 0;
                score = 0;
                incorrectlyAnswered = [];
                scoreText.textContent = score;

                showNextQuestion();
            }

            function showNextQuestion() {
                resetState();
                if (currentQuestionIndex < shuffledQuestions.length) {
                    progressText.textContent = `Câu ${currentQuestionIndex + 1} / ${shuffledQuestions.length}`;
                    const question = shuffledQuestions[currentQuestionIndex];
                    questionText.textContent = question.question;
                    question.answers.forEach((answer, index) => {
                        const button = document.createElement('button');
                        button.textContent = answer;
                        button.classList.add('btn', 'answer-btn', 'w-full', 'p-4', 'rounded-lg', 'font-semibold', 'bg-white', 'border-2', 'border-slate-300', 'hover:bg-indigo-100', 'hover:border-indigo-400');
                        button.addEventListener('click', () => selectAnswer(button, index));
                        answerButtonsContainer.appendChild(button);
                    });
                    startTimer();
                } else {
                    endGame();
                }
            }

            function resetState() {
                clearInterval(timerInterval);
                answerButtonsContainer.innerHTML = '';
                timerBar.style.transition = 'none';
                timerBar.style.width = '100%';
                void timerBar.offsetWidth; 
                timerBar.style.transition = `width ${QUESTION_TIME_LIMIT}s linear`;
            }

            function startTimer() {
                timeLeft = QUESTION_TIME_LIMIT;
                timerBar.style.width = '0%';
                timerInterval = setInterval(() => {
                    timeLeft--;
                    if (timeLeft < 0) {
                        clearInterval(timerInterval);
                        handleIncorrectAnswer(-1); // -1 indicates timeout
                    }
                }, 1000);
            }
            
            function handleIncorrectAnswer(selectedIndex) {
                incorrectlyAnswered.push({
                    question: shuffledQuestions[currentQuestionIndex],
                    selectedIndex: selectedIndex
                });
                incorrectSound.triggerAttackRelease("A2", "8n");
                
                Array.from(answerButtonsContainer.children).forEach((btn, index) => {
                    btn.disabled = true;
                    if (index === shuffledQuestions[currentQuestionIndex].correct) {
                        btn.classList.add('correct');
                    }
                    if (index === selectedIndex) {
                        btn.classList.add('incorrect');
                    }
                });

                currentQuestionIndex++;
                setTimeout(showNextQuestion, 2000);
            }

            function selectAnswer(button, selectedIndex) {
                clearInterval(timerInterval);
                const correct = selectedIndex === shuffledQuestions[currentQuestionIndex].correct;
                
                Array.from(answerButtonsContainer.children).forEach(btn => {
                    btn.disabled = true;
                });

                if (correct) {
                    score++;
                    scoreText.textContent = score;
                    button.classList.add('correct');
                    correctSound.triggerAttackRelease("G4", "8n", Tone.now());
                    correctSound.triggerAttackRelease("C5", "8n", Tone.now() + 0.1);
                    currentQuestionIndex++;
                    setTimeout(showNextQuestion, 1500);
                } else {
                    handleIncorrectAnswer(selectedIndex);
                }
            }

            function endGame() {
                switchScreen(endScreen);
                finalScoreText.textContent = `${score} / ${questions.length}`;
                
                if (incorrectlyAnswered.length > 0) {
                    reviewBtn.classList.remove('hidden');
                } else {
                    reviewBtn.classList.add('hidden');
                }
                
                let message = "";
                const percentage = (score / questions.length) * 100;
                if (percentage === 100) {
                    message = "Tuyệt vời! Bạn là một chuyên gia thực thụ!";
                } else if (percentage >= 70) {
                    message = "Làm tốt lắm! Kiến thức của bạn rất vững chắc.";
                } else if (percentage >= 40) {
                    message = "Khá lắm! Hãy thử lại để đạt điểm cao hơn nhé.";
                } else {
                    message = "Đừng nản lòng! Ôn lại bài và thử lại nào.";
                }
                scoreMessageText.textContent = message;
            }
            
            function displayReview() {
                reviewItemsContainer.innerHTML = '';
                incorrectlyAnswered.forEach((item, index) => {
                    const q = item.question;
                    const card = document.createElement('div');
                    card.classList.add('bg-slate-50', 'p-4', 'rounded-lg', 'mb-4', 'border', 'border-slate-200');

                    let answersHTML = '';
                    q.answers.forEach((answer, ansIndex) => {
                        let classes = 'block w-full text-left p-3 my-2 rounded-md border text-sm font-medium';
                        if (ansIndex === q.correct) {
                            classes += ' bg-green-100 text-green-800 border-green-300';
                        } else if (ansIndex === item.selectedIndex) {
                            classes += ' bg-red-100 text-red-800 border-red-300';
                        } else {
                            classes += ' bg-slate-200 border-slate-300 text-slate-600';
                        }
                        answersHTML += `<div class="${classes}">${answer}</div>`;
                    });

                    card.innerHTML = `
                        <p class="font-bold mb-2 text-slate-700">${index + 1}. ${q.question}</p>
                        <div>${answersHTML}</div>
                    `;
                    reviewItemsContainer.appendChild(card);
                });
            }

            // --- EVENT LISTENERS ---
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            reviewBtn.addEventListener('click', () => {
                switchScreen(reviewScreen);
                displayReview();
            });
            backToScoreBtn.addEventListener('click', () => switchScreen(endScreen));
        });
    </script>
</body>
</html>
