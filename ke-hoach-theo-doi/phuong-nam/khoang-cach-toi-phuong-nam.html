<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>So sánh khoảng cách đến nhà sách</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better Vietnamese display and general aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background-color: #fff;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .chart-bar {
            background-color: #2563eb; /* Blue for bars */
            height: 25px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            color: #fff;
            font-weight: 500;
            transition: width 0.5s ease-out; /* Smooth transition for bar width */
            overflow: hidden; /* Hide overflow text if bar is too small */
        }
        .chart-label {
            width: 180px; /* Increased width for labels to prevent overflow */
            flex-shrink: 0;
            text-align: right;
            padding-right: 1rem;
            font-weight: 500;
            color: #4a5568;
        }
        .distance-value {
            min-width: 70px; /* Ensure space for distance text */
            text-align: right;
            font-weight: 600;
            color: #2563eb;
        }
        .table-header {
            background-color: #e2e8f0; /* Light gray for table header */
            color: #2d3748;
        }
        .table-row:nth-child(even) {
            background-color: #f7fafc; /* Alternate row background */
        }
        .schedule-distance {
            font-size: 0.875rem; /* text-sm */
            color: #4a5568; /* gray-700 */
            margin-top: 0.25rem;
            display: block;
        }
        .schedule-attendees {
            font-weight: 500;
            color: #2b6cb0; /* blue-700 */
        }
        .cost-info {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* gray-500 */
            margin-top: 0.5rem;
        }
        .individual-cost-info {
            margin-top: 0.25rem;
            padding-left: 1rem;
            font-size: 0.825rem;
            color: #555;
            border-left: 2px solid #a7b2c9;
            padding-bottom: 0.1rem;
        }
        .daily-individual-total {
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #cbd5e0;
            font-weight: 600;
            color: #1a202c;
        }
        .suggestion-table th, .suggestion-table td, .schedule-summary-table th, .schedule-summary-table td {
            padding: 0.75rem;
            text-align: left;
            vertical-align: top;
            border-bottom: 1px solid #e2e8f0;
        }
        .suggestion-table thead th, .schedule-summary-table thead th {
            background-color: #e2e8f0;
            color: #2d3748;
            font-weight: 600;
        }
        .suggestion-table tbody tr:nth-child(odd), .schedule-summary-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        .suggestion-table tbody tr:nth-child(even), .schedule-summary-table tbody tr:nth-child(even) {
            background-color: #f7fafc;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 text-indigo-700">So sánh khoảng cách đến nhà sách</h1>
        <p class="text-center text-gray-600 mb-8">
            <span class="font-semibold text-red-600">Lưu ý quan trọng:</span> Các khoảng cách dưới đây chỉ là <strong class="text-red-700">ước tính</strong> dựa trên vị trí quận/huyện và không phải là số liệu chính xác từ bản đồ.
        </p>

        <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Thông tin địa điểm của bạn:</h2>
            <ul class="list-disc list-inside text-gray-700">
                <li>Nhà bạn (Hưng): <span class="font-medium">Xuân Thới Thượng, Hóc Môn</span></li>
                <li>Nhà bạn bè 1 (Khang): <span class="font-medium">Công viên Phú Lâm, Bình Tân</span></li>
                <li>Nhà bạn bè 2 (An): <span class="font-medium">Lạc Long Quân, Âu Cơ, TP.HCM</span></li>
                <li>Bạn bè 3 (Thiết): <span class="font-medium">245B Trần Quang Khải, Quận 1</span></li>
            </ul>
        </div>

        <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Nhà sách gần nhất và xếp hạng:</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm">
                    <thead>
                        <tr class="table-header text-left">
                            <th class="py-3 px-4 font-semibold text-sm rounded-tl-lg">Hạng</th>
                            <th class="py-3 px-4 font-semibold text-sm">Nhà sách</th>
                            <th class="py-3 px-4 font-semibold text-sm">Quận</th>
                            <th class="py-3 px-4 font-semibold text-sm">Khoảng cách từ Hưng (km)</th>
                            <th class="py-3 px-4 font-semibold text-sm">Khoảng cách từ Khang (km)</th>
                            <th class="py-3 px-4 font-semibold text-sm">Khoảng cách từ An (km)</th>
                            <th class="py-3 px-4 font-semibold text-sm rounded-tr-lg">Khoảng cách từ Thiết (km)</th>
                        </tr>
                    </thead>
                    <tbody id="bookstore-list">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mt-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Biểu đồ so sánh khoảng cách:</h2>
            <p class="text-sm text-gray-500 mb-4 text-center">Chiều dài thanh biểu thị khoảng cách (km). Các biểu đồ được sắp xếp riêng lẻ theo khoảng cách từ từng vị trí.</p>
            <div id="charts-wrapper" class="space-y-8">
                <!-- Individual charts will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- New section for daily schedule table -->
        <div class="card mt-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Tổng hợp Lịch trình và Chi phí Hàng ngày:</h2>
            <p class="text-gray-600 mb-4">
                <span class="font-semibold">Lưu ý về điểm xuất phát:</span>
                <ul>
                    <li>Trong giờ làm việc của Thiết (T2-T6: 8h-17h45, T7: 8h-16h): Hưng, Khang, An sẽ xuất phát từ địa điểm của Thiết (245B Trần Quang Khải, Q1).</li>
                    <li>Ngoài giờ làm việc của Thiết (và Chủ Nhật): Các bạn sẽ xuất phát từ nhà riêng.</li>
                    <li>Quy tắc tham gia của Hưng: Hưng sẽ không tham gia nếu khoảng cách di chuyển của Hưng lớn hơn 24km.</li>
                </ul>
                <span class="font-semibold mt-2 block">Chi phí ước tính:</span> (Xăng: 4.000 VND/km; Ăn: 50.000 VND/người/buổi)
            </p>
            <div class="overflow-x-auto">
                <table class="min-w-full schedule-summary-table rounded-lg overflow-hidden shadow-sm">
                    <thead>
                        <tr>
                            <th>Ngày & Thời gian</th>
                            <th>Nhà sách</th>
                            <th>Thành viên tham gia & Chi phí cá nhân</th>
                            <th>Tổng quãng đường nhóm (Km)</th>
                            <th>Tổng chi phí nhóm (VND)</th>
                        </tr>
                    </thead>
                    <tbody id="daily-schedule-table">
                        <!-- Daily schedule data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mt-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Tổng chi phí dự kiến cho 2 tháng (Tháng 7 - Tháng 9):</h2>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-blue-800">
                <p class="text-lg font-semibold mb-2">Tổng chi phí ước tính dựa trên lịch trình và các khoản mục đã cung cấp:</p>
                <ul class="list-disc list-inside space-y-1">
                    <li><span class="font-medium">Tổng chi phí xăng cho 2 tháng:</span> 4.368.000 VND</li>
                    <li><span class="font-medium">Tổng chi phí ăn cho 2 tháng:</span> 6.400.000 VND</li>
                    <li><span class="font-bold text-xl text-blue-900">Tổng chi phí chung cho 2 tháng (Xăng + Ăn):</span> <span class="font-bold text-xl text-blue-900">10.768.000 VND</span></li>
                </ul>
            </div>

            <!-- New section for individual totals -->
            <div class="card mt-8">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">Tổng chi phí cá nhân dự kiến cho 2 tháng (x 8 lần):</h2>
                <div id="individual-total-costs" class="bg-green-50 border border-green-200 rounded-lg p-4 text-green-800">
                    <!-- Individual totals will be inserted here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Cost constants
            const FUEL_COST_PER_KM = 4000; // VND per km for motorcycle (updated from 2000 to 4000)
            const FOOD_COST_PER_PERSON_PER_MEETING = 50000; // VND per person per meeting (example)

            // Define the data for bookstores and origins
            const bookstores = [
                { name: "Bookcity Vạn Hạnh Mall", address: "Tầng 3, TTM Vạn Hạnh Mall, 11 Sư Vạn Hạnh, Phường 12, Quận 10, Thành phố Hồ Chí Minh", district: "Quận 10" },
                { name: "Nhà sách Crescent Mall", address: "Tầng 3, ĐQT bằng 3F-508, 59 - 374 18 m2, TTM Crescent Mall Phú Mỹ Hưng, 101 Tôn Dật Tiên, Phường Tân Phú, Quận 7, Thành phố Hồ Chí Minh", district: "Quận 7" },
                { name: "Nhà sách Nguyễn Oanh", address: "03 Nguyễn Oanh, Phường 10, Quận Gò Vấp, Thành phố Hồ Chí Minh", district: "Gò Vấp" },
                { name: "Nhà sách Estella", address: "Tầng 4, Trung tâm mua sắm Estella Place, SỐ 88 Đường Song Hành, Phường An Phú, Quận 2, Thành phố Hồ Chí Minh", district: "Quận 2" },
                { name: "Nhà sách Phú Thọ", address: "940 Đường 3/2, Phường 15, Quận 11, Thành phố Hồ Chí Minh", district: "Quận 11" },
                { name: "Nhà sách Saigon Centre Lê Lợi", address: "Tầng 4, 65 Lê Lợi, Quận 1, Thành phố Hồ Chí Minh", district: "Quận 1" },
                { name: "Nhà sách Nguyễn Trãi", address: "212 Nguyễn Trãi, P.Phạm Ngũ Lão, Q1, TP HCM", district: "Quận 1" },
                { name: "Nhà sách Vincom Đồng Khởi", address: "Tầng B2, TTM Vincom, 72 Lê Thánh Tôn, Phường Bến Nghé, Quận 1, Thành phố Hồ Chí Minh", district: "Quận 1" },
                { name: "Nhà sách Vivo City", address: "Tầng 3, TTM Vivo City, 1058 Đại Lộ Nguyễn Văn Linh, Phường Tân Phong, Quận 7, Thành phố Hồ Chí Minh", district: "Quận 7" },
                { name: "Nhà sách Trần Quang Khải", address: "245b Trần Quang Khải, Quận 1, Thành phố Hồ Chí Minh", district: "Quận 1" }
            ];

            // Updated origins based on user request
            const origins = [
                { name: "Hưng", location: "Xuân Thới Thượng, Hóc Môn", key: "distFromHưngHome" },
                { name: "Khang", location: "Công viên Phú Lâm, Bình Tân", key: "distFromKhangHome" }, // Updated Khang's location
                { name: "An", location: "Lạc Long Quân, Âu Cơ, TP.HCM", key: "distFromAnHome" },       // Updated An's location
                { name: "Thiết", location: "Trần Quang Khải, Quận 1", key: "distFromThiếtHome" } // Corresponds to Thiết's home/office
            ];

            // Estimated distances in KM by district (simplified estimations for demonstration)
            // Updated keys to match the new origins locations
            const estimatedDistances = {
                "Xuân Thới Thượng, Hóc Môn": { // Hưng's home
                    "Quận 10": 22, "Quận 7": 32, "Gò Vấp": 18, "Quận 2": 28, "Quận 11": 19, "Quận 1": 24, "Bình Tân": 20
                },
                "Công viên Phú Lâm, Bình Tân": { // Khang's new home (originally An's)
                    "Quận 10": 7, "Quận 7": 15, "Gò Vấp": 10, "Quận 2": 18, "Quận 11": 3, "Quận 1": 9, "Bình Tân": 1
                },
                "Lạc Long Quân, Âu Cơ, TP.HCM": { // An's new home (originally Khang's)
                    "Quận 10": 4, "Quận 7": 12, "Gò Vấp": 6, "Quận 2": 10, "Quận 11": 2, "Quận 1": 7, "Bình Tân": 5
                },
                "Trần Quang Khải, Quận 1": { // Thiết's home/Hưng, Khang, An's office start point
                    "Quận 10": 3,   // Bookcity Vạn Hạnh Mall
                    "Quận 7": 9,    // Crescent Mall, Vivo City
                    "Gò Vấp": 8,    // Nguyễn Oanh
                    "Quận 2": 5,    // Estella
                    "Quận 11": 4,   // Phú Thọ
                    "Quận 1": 0.5,  // Saigon Centre, Nguyễn Trãi, Vincom, Trần Quang Khải itself
                    "Bình Tân": 10
                }
            };

            let results = [];

            // Calculate distances for each bookstore from all origins (homes)
            bookstores.forEach(bookstore => {
                let distFromHưngHome = estimatedDistances[origins[0].location][bookstore.district] || 999;
                let distFromKhangHome = estimatedDistances[origins[1].location][bookstore.district] || 999; // Using Khang's new location
                let distFromAnHome = estimatedDistances[origins[2].location][bookstore.district] || 999;     // Using An's new location
                let distFromThiếtHome = estimatedDistances[origins[3].location][bookstore.district] || 999; // Thiết's home distance

                results.push({
                    name: bookstore.name,
                    address: bookstore.address,
                    district: bookstore.district,
                    distFromHưngHome: distFromHưngHome,
                    distFromKhangHome: distFromKhangHome,
                    distFromAnHome: distFromAnHome,
                    distFromThiếtHome: distFromThiếtHome, // Use Thiết's distance
                    // minDistance is not used in table display but kept for potential future sorting
                    minDistance: Math.min(distFromHưngHome, distFromKhangHome, distFromAnHome, distFromThiếtHome)
                });
            });

            // Sort results by the minimum distance in ascending order (for the main table's "Hạng")
            results.sort((a, b) => a.minDistance - b.minDistance);

            const bookstoreList = document.getElementById('bookstore-list');
            bookstoreList.innerHTML = ''; // Clear previous content

            // Populate the main table
            results.forEach((bookstore, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="py-3 px-4 text-sm">${index + 1}</td>
                    <td class="py-3 px-4 text-sm font-medium text-blue-700">${bookstore.name}</td>
                    <td class="py-3 px-4 text-sm text-gray-600">${bookstore.district}</td>
                    <td class="py-3 px-4 text-sm text-gray-800">${bookstore.distFromHưngHome} km</td>
                    <td class="py-3 px-4 text-sm text-gray-800">${bookstore.distFromKhangHome} km</td>
                    <td class="py-3 px-4 text-sm text-gray-800">${bookstore.distFromAnHome} km</td>
                    <td class="py-3 px-4 text-sm text-gray-800">${bookstore.distFromThiếtHome} km</td>
                `;
                bookstoreList.appendChild(row);
            });

            // --- Chart Generation for each person ---
            const chartsWrapper = document.getElementById('charts-wrapper');
            chartsWrapper.innerHTML = ''; // Clear previous charts

            function renderChart(data, title, distanceKey) {
                const chartDiv = document.createElement('div');
                chartDiv.className = 'mb-6 p-4 bg-gray-50 rounded-lg shadow-sm'; // Styling for individual chart sections
                chartDiv.innerHTML = `<h3 class="text-xl font-semibold mb-3 text-gray-700">${title}</h3>`;
                
                const validDistances = data.filter(b => b[distanceKey] !== 999).map(b => b[distanceKey]);
                const maxDist = validDistances.length > 0 ? Math.max(...validDistances) : 1;

                // Sort data for chart to display shortest distance first
                const sortedData = [...data].sort((a, b) => {
                    const distA = a[distanceKey] === 999 ? Infinity : a[distanceKey];
                    const distB = b[distanceKey] === 999 ? Infinity : b[distanceKey];
                    return distA - distB;
                });

                sortedData.forEach(bookstore => {
                    const barWrapper = document.createElement('div');
                    barWrapper.className = 'flex items-center space-x-2 mb-2';
                    const distanceValue = bookstore[distanceKey];
                    const barText = distanceValue === 999 ? 'Không xác định' : `${distanceValue} km`;
                    const barWidthPercentage = distanceValue === 999 ? 0 : (distanceValue / maxDist) * 95; // Max 95% to leave room for label

                    barWrapper.innerHTML = `
                        <div class="chart-label">${bookstore.name}</div>
                        <div class="flex-grow">
                            <div class="chart-bar" style="width: ${barWidthPercentage}%;">
                                <span class="ml-2 whitespace-nowrap">${barText}</span>
                            </div>
                        </div>
                    `;
                    chartDiv.appendChild(barWrapper);
                });
                chartsWrapper.appendChild(chartDiv);
            }

            // Render chart for each origin (home distances)
            renderChart(results, 'Khoảng cách từ Nhà bạn (Hưng)', 'distFromHưngHome');
            renderChart(results, 'Khoảng cách từ Nhà bạn bè 1 (Khang)', 'distFromKhangHome'); // Khang's new chart
            renderChart(results, 'Khoảng cách từ Nhà bạn bè 2 (An)', 'distFromAnHome');       // An's new chart
            renderChart(results, 'Khoảng cách từ Bạn bè 3 (Thiết)', 'distFromThiếtHome');


            // --- Daily Schedule Table Generation ---
            const dailyScheduleTable = document.getElementById('daily-schedule-table');
            dailyScheduleTable.innerHTML = ''; // Clear existing table content

            // Data for schedule (UPDATED for proposed changes)
            const scheduleData = [
                { day: "Thứ 2", isWeekday: true, time: "10h - 12h", bookstoreShort: "Crescent mall", originalAttendees: ["Hưng", "Khang"] },
                { day: "Thứ 3", isWeekday: true, time: "10h - 12h", bookstoreShort: "Estella", originalAttendees: ["Khang", "An"] },
                { day: "Thứ 4", isWeekday: true, time: "10h - 12h", bookstoreShort: "Phú Thọ", originalAttendees: ["Hưng", "Khang"] },
                // Proposed change for Thứ 5
                { day: "Thứ 5", isWeekday: true, time: "18h - 20h", bookstoreShort: "Vạn Hạnh", originalAttendees: ["An", "Khang", "Hưng"] },
                { day: "Thứ 6", isWeekday: true, time: "10h - 12h", bookstoreShort: "Vico", originalAttendees: ["Hưng", "Khang"] },
                { day: "Thứ 7", isWeekday: true, time: "2 ca", bookstoreShort: "Vạn Hạnh", originalAttendees: ["Hưng", "Khang", "An"] },
                // Chủ Nhật remains unchanged
                { day: "Chủ Nhật", isWeekday: false, time: "18h - 20h", bookstoreShort: "Nhà sách Nguyễn Oanh", originalAttendees: ["Hưng", "Khang"] },
            ];

            // Mapping short names to full names from 'bookstores' array for easier lookup
            const bookstoreMap = {
                "Crescent mall": "Nhà sách Crescent Mall",
                "Estella": "Nhà sách Estella",
                "Phú Thọ": "Nhà sách Phú Thọ",
                "SG LÊ Lợi": "Nhà sách Saigon Centre Lê Lợi",
                "Vico": "Nhà sách Vincom Đồng Khởi",
                "Vạn Hạnh": "Bookcity Vạn Hạnh Mall", // Corrected to full name
                "Nhà sách Nguyễn Oanh": "Nhà sách Nguyễn Oanh",
                "Trần Quang Khải": "Nhà sách Trần Quang Khải"
            };

            // Function to check if a time string falls within Thiết's working hours
            function isDuringThiếtWorkingHours(day, timeStr) {
                if (timeStr.includes("2 ca")) return false; 
                const [startTimeStr] = timeStr.split(' - ').map(t => t.trim());
                let startHour = parseInt(startTimeStr.split('h')[0], 10);
                let startMinute = parseInt(startTimeStr.split('h')[1] || '0', 10);
                const meetingStartInMinutes = startHour * 60 + startMinute;
                const officeStartHour = 8 * 60; // 8:00
                
                if (["Thứ 2", "Thứ 3", "Thứ 4", "Thứ 5", "Thứ 6"].includes(day)) {
                    const officeEndHour = 17 * 60 + 45; // 17:45
                    return meetingStartInMinutes >= officeStartHour && meetingStartInMinutes < officeEndHour;
                } else if (day === "Thứ 7") {
                    const officeEndHour = 16 * 60; // 16:00
                    return meetingStartInMinutes >= officeStartHour && meetingStartInMinutes < officeEndHour;
                }
                return false;
            }

            // Initialize total costs for each person over 2 months (for the final summary)
            const individualTotalCostsFor2Months = {
                "Hưng": { fuel: 0, food: 0 },
                "Khang": { fuel: 0, food: 0 },
                "An": { fuel: 0, food: 0 },
                "Thiết": { fuel: 0, food: 0 }
            };

            scheduleData.forEach(item => {
                const fullBookstoreName = bookstoreMap[item.bookstoreShort] || item.bookstoreShort;
                const bookstoreInfo = results.find(b => b.name === fullBookstoreName);

                if (bookstoreInfo) {
                    let attendingMembers = [];
                    let totalTripDistance = 0;
                    const startsFromThiếtsPlace = isDuringThiếtWorkingHours(item.day, item.time);
                    
                    item.originalAttendees.forEach(person => {
                        let currentDistance = 0;
                        let shouldAttend = true;
                        let originLocation = "";

                        if (person === 'Hưng') {
                            if (startsFromThiếtsPlace) {
                                currentDistance = estimatedDistances["Trần Quang Khải, Quận 1"][bookstoreInfo.district] || 999;
                                originLocation = "Thiết's Office (Q1)";
                            } else {
                                currentDistance = bookstoreInfo.distFromHưngHome;
                                originLocation = "Nhà Hưng";
                            }
                            if (currentDistance > 24) { // Hưng's 24km rule
                                shouldAttend = false;
                            }
                        } else if (person === 'Khang') {
                            if (startsFromThiếtsPlace) {
                                currentDistance = estimatedDistances["Trần Quang Khải, Quận 1"][bookstoreInfo.district] || 999;
                                originLocation = "Thiết's Office (Q1)";
                            } else {
                                currentDistance = bookstoreInfo.distFromKhangHome;
                                originLocation = "Nhà Khang (Bình Tân)";
                            }
                        } else if (person === 'An') {
                            if (startsFromThiếtsPlace) {
                                currentDistance = estimatedDistances["Trần Quang Khải, Quận 1"][bookstoreInfo.district] || 999;
                                originLocation = "Thiết's Office (Q1)";
                            } else {
                                currentDistance = bookstoreInfo.distFromAnHome;
                                originLocation = "Nhà An (Q11)";
                            }
                        } else if (person === 'Thiết') {
                            currentDistance = bookstoreInfo.distFromThiếtHome;
                            originLocation = "Nhà Thiết (Q1)";
                        }

                        if (shouldAttend && currentDistance !== 999) {
                            const fuelCost = currentDistance * FUEL_COST_PER_KM;
                            const foodCost = FOOD_COST_PER_PERSON_PER_MEETING;
                            attendingMembers.push({ name: person, distance: currentDistance, origin: originLocation, fuelCost: fuelCost, foodCost: foodCost });
                            totalTripDistance += currentDistance;

                            individualTotalCostsFor2Months[person].fuel += fuelCost;
                            individualTotalCostsFor2Months[person].food += foodCost;
                        }
                    });

                    attendingMembers.sort((a, b) => {
                        const order = {'Hưng': 1, 'Khang': 2, 'An': 3, 'Thiết': 4};
                        return order[a.name] - order[b.name];
                    });

                    // Construct HTML for individual members and their costs
                    let individualDetailsHtml = '';
                    attendingMembers.forEach(member => {
                        individualDetailsHtml += `
                            <div class="mb-1">
                                <span class="font-medium">${member.name}:</span>
                                Từ ${member.origin}, ${member.distance} km<br>
                                Chi phí xăng: ${member.fuelCost.toLocaleString('vi-VN')} VND, Ăn: ${member.foodCost.toLocaleString('vi-VN')} VND<br>
                                <strong class="text-blue-700">Tổng: ${(member.fuelCost + member.foodCost).toLocaleString('vi-VN')} VND</strong>
                            </div>
                        `;
                    });

                    const totalFoodCostGroup = attendingMembers.length * FOOD_COST_PER_PERSON_PER_MEETING;
                    const totalFuelCostGroup = totalTripDistance * FUEL_COST_PER_KM;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <strong class="text-gray-800">${item.day}</strong><br>
                            <span class="text-sm text-gray-600">(${item.time})</span>
                        </td>
                        <td><strong class="text-blue-700">${bookstoreInfo.name}</strong></td>
                        <td>
                            ${attendingMembers.length > 0 ? individualDetailsHtml : '<span class="text-red-500">Không có ai tham gia</span>'}
                        </td>
                        <td>${totalTripDistance.toLocaleString('vi-VN')}</td>
                        <td>
                            Xăng: ${totalFuelCostGroup.toLocaleString('vi-VN')} VND<br>
                            Ăn: ${totalFoodCostGroup.toLocaleString('vi-VN')} VND<br>
                            <strong class="text-indigo-700">Tổng nhóm: ${(totalFuelCostGroup + totalFoodCostGroup).toLocaleString('vi-VN')} VND</strong>
                        </td>
                    `;
                    dailyScheduleTable.appendChild(row);

                } else {
                    console.warn(`Bookstore not found for schedule item: ${item.bookstoreShort}`);
                }
            });

            // Display individual total costs for 2 months (x 8 times)
            const individualTotalCostsDiv = document.getElementById('individual-total-costs');
            let individualTotalsHtml = `<ul class="list-disc list-inside space-y-1">`;
            for (const person in individualTotalCostsFor2Months) {
                const totalFuel = individualTotalCostsFor2Months[person].fuel * 8; // Multiply by 8
                const totalFood = individualTotalCostsFor2Months[person].food * 8; // Multiply by 8
                const grandTotal = totalFuel + totalFood;
                individualTotalsHtml += `
                    <li><span class="font-medium">${person}:</span>
                        Tổng chi phí xăng: ${totalFuel.toLocaleString('vi-VN')} VND,
                        Tổng chi phí ăn: ${totalFood.toLocaleString('vi-VN')} VND,
                        Tổng cộng: <span class="font-bold text-lg text-green-900">${grandTotal.toLocaleString('vi-VN')} VND</span>
                    </li>
                `;
            }
            individualTotalsHtml += `</ul>`;
            individualTotalCostsDiv.innerHTML = individualTotalsHtml;
        });
    </script>
</body>
</html>
